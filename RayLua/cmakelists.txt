cmake_minimum_required(VERSION 3.21)
cmake_policy(VERSION 3.5)
set(CMAKE_GENERATOR_PLATFORM Win32)
set(CMAKE_VERBOSE_MAKEFILE ON)
set(CMAKE_SIZEOF_VOID_P 4)
project(raylib_lua_imgui C CXX)

set(CMAKE_C_STANDARD 11)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

option(DISABLE_LUA "Disable Lua support" ON)
#add_compile_definitions(DISABLE_LUA)

include(FetchContent)

# Try to find raylib first, fallback to FetchContent
find_package(raylib QUIET)
if (NOT raylib_FOUND)
    message(STATUS "raylib not found, fetching...")
    FetchContent_Declare(
            raylib
            GIT_REPOSITORY https://github.com/raysan5/raylib.git
            GIT_TAG 5.5
    )
    FetchContent_MakeAvailable(raylib)
endif ()

# ImGui - always use FetchContent since it doesn't have find_package support
FetchContent_Declare(
        imgui
        GIT_REPOSITORY https://github.com/ocornut/imgui.git
        GIT_TAG v1.92.1
)
FetchContent_MakeAvailable(imgui)

# Create imgui target
add_library(imgui STATIC
        ${imgui_SOURCE_DIR}/imgui.cpp
        ${imgui_SOURCE_DIR}/imgui_demo.cpp
        ${imgui_SOURCE_DIR}/imgui_draw.cpp
        ${imgui_SOURCE_DIR}/imgui_tables.cpp
        ${imgui_SOURCE_DIR}/imgui_widgets.cpp
        ${imgui_SOURCE_DIR}/backends/imgui_impl_opengl3.cpp
)
target_include_directories(imgui PUBLIC ${imgui_SOURCE_DIR} ${imgui_SOURCE_DIR}/backends)

# RlImGui
FetchContent_Declare(
        rlimgui
        GIT_REPOSITORY https://github.com/raylib-extras/rlImGui.git
        GIT_TAG 4d8a618
)
FetchContent_MakeAvailable(rlimgui)

add_library(rlimgui STATIC ${rlimgui_SOURCE_DIR}/rlImGui.cpp)
target_link_libraries(rlimgui PUBLIC raylib imgui)
target_include_directories(rlimgui PUBLIC ${rlimgui_SOURCE_DIR})

include(luajit.cmake) # will handle directive.

include(shared.cmake)

include(raygame.cmake)
include(duke_target.cmake)
# Debug file copying
message(STATUS "Source directory: ${CMAKE_CURRENT_SOURCE_DIR}")
#get_filename_component(EXE_FOLDER_PATH ${TARGET_FILE} DIRECTORY)
set(EXE_FOLDER_PATH "${CMAKE_CURRENT_SOURCE_DIR}/Bin/Debug")
message(STATUS "Binary directory: ${EXE_FOLDER_PATH}")

# Copy with verbose output
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/uv_vis_shader.vs ${EXE_FOLDER_PATH}/uv_vis_shader.vs COPYONLY)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/uv_vis_shader.vs ${EXE_FOLDER_PATH}/uv_vis_shader.vs COPYONLY)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/light.vs ${EXE_FOLDER_PATH}/light.vs COPYONLY)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/light.fs ${EXE_FOLDER_PATH}/light.fs COPYONLY)

